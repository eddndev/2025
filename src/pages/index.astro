---
import Layout from "../layouts/Layout.astro";
import { getCollection } from 'astro:content';

const latestBlog = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
)[0];

const latestLeetCode = (await getCollection('leetcode')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
)[0];

const difficultyColor = {
	Easy: 'text-emerald-500 bg-emerald-50',
	Medium: 'text-amber-500 bg-amber-50',
	Hard: 'text-rose-500 bg-rose-50',
};
---

<Layout title="eddn.dev — Eduardo Alonso">
	<main
		class="relative max-w-7xl mx-auto px-6 overflow-visible"
	>
		<div class="relative min-h-[100dvh] flex items-center py-24 sm:py-32">
			<!-- Decorative Background/Blob -->
			<div
				class="absolute inset-0 lg:-top-20 lg:-right-20 lg:left-auto lg:bottom-auto lg:w-[1000px] lg:h-[1000px] -z-10 opacity-40 lg:opacity-80 pointer-events-none [mask-image:linear-gradient(to_top,white,transparent)] lg:[mask-image:radial-gradient(closest-side,white,transparent)]"
			>
				<div
					class="w-full h-full lg:[border-radius:64%_36%_27%_73%_/_55%_58%_42%_45%]"
				>
					<canvas id="hero-canvas" class="w-full h-full"></canvas>
				</div>
			</div>

			<div class="grid lg:grid-cols-2 gap-12 lg:gap-20 items-center w-full">
				<!-- Left Column: Content -->
				<header class="space-y-8 relative z-10">
					<h1
						class="text-6xl sm:text-8xl font-black tracking-tighter text-slate-900 leading-[0.85]"
					>
						EDD <br />
						<span
							class="text-brand-500 underline decoration-brand-100 decoration-8 underline-offset-8"
							>JOURNAL.</span
						>
					</h1>

					<p
						class="text-xl sm:text-2xl text-slate-600 font-light leading-relaxed max-w-2xl"
					>
						Un espacio personal dedicado a la <span
							class="text-slate-900 font-medium"
							>ingeniería de software</span
						>, la resolución de problemas algorítmicos y reflexiones
						sobre el desarrollo de productos.
					</p>

					<div class="flex flex-wrap gap-4 pt-4">
						<a
							href="/blog"
							class="px-6 py-3 bg-brand-500 text-white font-bold rounded-full hover:bg-brand-600 transition-colors shadow-lg shadow-brand-500/20"
						>
							Explorar Blog
						</a>
						<a
							href="/trajectory"
							class="px-6 py-3 bg-white text-slate-900 font-bold rounded-full border border-slate-200 hover:bg-slate-50 transition-colors"
						>
							Ver Trayectoria
						</a>
					</div>
				</header>

				<!-- Right Column Spacer (keeps text on left in grid layout) -->
				<div class="hidden lg:block"></div>
			</div>
		</div>

		<section class="pb-32 grid grid-cols-1 md:grid-cols-2 gap-8">
			{/* Latest Blog Post Card */}
			{latestBlog && (
				<article class="group relative flex flex-col justify-between p-8 bg-white border border-slate-200 border-r-4 border-r-slate-200 hover:border-r-brand-500 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 rounded-none h-full select-none">
					<div>
						<span class="block text-xs font-mono text-brand-500 font-bold uppercase tracking-widest mb-4 pointer-events-none">
							[ LATEST JOURNAL ]
						</span>
						<time 
							transition:name={`date-${latestBlog.id}`}
							class="relative z-10 mb-2 block text-xs font-mono text-slate-400 uppercase tracking-widest pointer-events-none"
						>
							{latestBlog.data.pubDate.toLocaleDateString('es-ES', {
								year: 'numeric',
								month: 'long',
								day: 'numeric',
							})}
						</time>
						
						<h3 
							transition:name={`title-${latestBlog.id}`}
							class="text-2xl font-bold text-slate-900 mb-4 group-hover:text-brand-600 transition-colors leading-tight"
						>
							<a href={`/blog/${latestBlog.id}`} class="focus:outline-none">
								<span class="absolute inset-0 z-20"></span>
								{latestBlog.data.title}
							</a>
						</h3>
						
						<p class="relative z-10 text-slate-600 leading-relaxed mb-6 line-clamp-3 pointer-events-none">
							{latestBlog.data.description}
						</p>
					</div>

					<div class="relative z-10 flex items-center text-sm font-bold text-brand-500 group-hover:translate-x-2 transition-transform duration-300 pointer-events-none">
						Leer artículo
						<svg class="ml-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
						</svg>
					</div>
				</article>
			)}

			{/* Latest LeetCode Solution Card */}
			{latestLeetCode && (
				<article class="group relative flex flex-col justify-between p-8 bg-white border border-slate-200 border-r-4 border-r-slate-200 hover:border-r-brand-500 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 rounded-none h-full select-none">
					<div>
						<div class="flex justify-between items-start mb-4 pointer-events-none">
							<span class="text-xs font-mono text-brand-500 font-bold uppercase tracking-widest">
								[ LATEST SOLUTION ]
							</span>
							<span 
								transition:name={`difficulty-${latestLeetCode.id}`}
								class={`text-xs font-bold px-2 py-0.5 rounded-full ${difficultyColor[latestLeetCode.data.difficulty as keyof typeof difficultyColor]}`}
							>
								{latestLeetCode.data.difficulty}
							</span>
						</div>
						
						<h3 
							transition:name={`title-${latestLeetCode.id}`}
							class="text-2xl font-bold text-slate-900 mb-4 group-hover:text-brand-600 transition-colors leading-tight"
						>
							<a href={`/leetcode/${latestLeetCode.id}`} class="focus:outline-none">
								<span class="absolute inset-0 z-20"></span>
								{latestLeetCode.data.title}
							</a>
						</h3>
						
						<div class="relative z-10 text-slate-600 leading-relaxed mb-6 font-mono text-sm pointer-events-none">
							{latestLeetCode.data.complexity ? (
								<div class="flex flex-col gap-1">
									<span>Time: {latestLeetCode.data.complexity.time}</span>
									<span>Space: {latestLeetCode.data.complexity.space}</span>
								</div>
							) : (
								<p>Ver análisis de complejidad y solución.</p>
							)}
						</div>
					</div>

					<div class="relative z-10 flex items-center text-sm font-bold text-brand-500 group-hover:translate-x-2 transition-transform duration-300 pointer-events-none">
						Ver Solución
						<svg class="ml-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
						</svg>
					</div>
				</article>
			)}
		</section>
	</main>

	<script>
		import { createRandomVisual, type VisualInstance } from "../utils/visuals";

		// Pattern for handling Astro View Transitions with interactive elements
		// 1. Track the active instance in a module-scoped variable
		let activeVisual: VisualInstance | null = null;

		function initHeroVisualization() {
			const canvas = document.getElementById(
				"hero-canvas",
			) as HTMLCanvasElement;
			
			if (!canvas) return;

			// Cleanup any existing instance just in case
			if (activeVisual) {
				activeVisual.destroy();
			}

			// Initialize using factory
			activeVisual = createRandomVisual(canvas, "#8b5cf6");
			activeVisual.init();
		}

		function cleanup() {
			if (activeVisual) {
				activeVisual.destroy();
				activeVisual = null;
			}
		}

		// 2. Initialize on every page load (initial + navigation)
		document.addEventListener("astro:page-load", initHeroVisualization);
		
		// 3. Cleanup before swapping content
		document.addEventListener("astro:before-swap", cleanup);
	</script>
</Layout>
